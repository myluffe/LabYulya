// heap.h - TODO: Description

#pragma once

#include <stdio.h>
#include "windows.h"
#include "Log.h"
#include "ErrorReporter.h"

#define SEGMENTSIZE 65539
#define SEGMENTCOUNT 1024
#define MAXSIZE 8388608

static class Heap
{
public:
	Heap();
	Heap GetHeap();
	~Heap();
	void*      get_mem(int size); //Возвращает указатель на выделенную память. На вход принимает кол-во байт для выделения.
	void       free_mem(void*); //Освобождает выделенную get_mem память по указателю. Знает сколько удалять.
private:
	Heap(int _segment_size);
	Heap* heap = nullptr;
	void print(); //Отладочная ф-ция печати.
	struct Chunk
	{
		bool      used;
		int       size;
		void*     offset;
	};

	struct Segment
	{
		void*        data;
		Segment*     prev;
		Chunk  descriptor[SEGMENTCOUNT];
		int          descriptor_count;
	};
	int		count_segments;
	int       make_segment();
	void      delete_segments();

	int       segment_size;

	Segment*  current;

};